
import React, { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { DropdownMenu, DropdownMenuContent, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';
import { Globe, ChevronDown } from 'lucide-react';
import { useCityContext } from './CityProvider';

// 扩展的城市数据结构 - 包含全球主要旅游城市
const cityData = {
  '中国': {
    '北京市': ['北京市'],
    '上海市': ['上海市'],
    '天津市': ['天津市'],
    '重庆市': ['重庆市'],
    '广东省': ['广州市', '深圳市', '珠海市', '佛山市', '东莞市', '中山市', '惠州市', '江门市', '湛江市', '茂名市', '肇庆市', '梅州市', '汕头市', '河源市', '阳江市', '清远市', '韶关市', '揭阳市', '汕尾市', '潮州市', '云浮市'],
    '山东省': ['济南市', '青岛市', '烟台市', '潍坊市', '临沂市', '淄博市', '济宁市', '泰安市', '聊城市', '威海市', '枣庄市', '德州市', '日照市', '东营市', '菏泽市', '滨州市', '莱芜市'],
    '江苏省': ['南京市', '苏州市', '无锡市', '常州市', '徐州市', '南通市', '连云港市', '淮安市', '盐城市', '扬州市', '镇江市', '泰州市', '宿迁市'],
    '浙江省': ['杭州市', '宁波市', '温州市', '嘉兴市', '湖州市', '绍兴市', '金华市', '衢州市', '舟山市', '台州市', '丽水市'],
    '河南省': ['郑州市', '洛阳市', '开封市', '南阳市', '安阳市', '商丘市', '新乡市', '平顶山市', '许昌市', '焦作市', '周口市', '信阳市', '驻马店市', '濮阳市', '三门峡市', '漯河市', '鹤壁市', '济源市'],
    '四川省': ['成都市', '绵阳市', '德阳市', '南充市', '宜宾市', '自贡市', '乐山市', '泸州市', '达州市', '内江市', '遂宁市', '攀枝花市', '眉山市', '广安市', '资阳市', '凉山州', '甘孜州', '阿坝州', '雅安市', '巴中市', '广元市'],
    '湖北省': ['武汉市', '宜昌市', '襄阳市', '荆州市', '十堰市', '黄冈市', '孝感市', '黄石市', '咸宁市', '随州市', '荆门市', '恩施州', '潜江市', '天门市', '仙桃市', '神农架林区'],
    '湖南省': ['长沙市', '株洲市', '湘潭市', '衡阳市', '邵阳市', '岳阳市', '常德市', '张家界市', '益阳市', '郴州市', '永州市', '怀化市', '娄底市', '湘西州'],
    '福建省': ['福州市', '厦门市', '莆田市', '三明市', '泉州市', '漳州市', '南平市', '龙岩市', '宁德市'],
    '安徽省': ['合肥市', '芜湖市', '蚌埠市', '淮南市', '马鞍山市', '淮北市', '铜陵市', '安庆市', '黄山市', '滁州市', '阜阳市', '宿州市', '六安市', '亳州市', '池州市', '宣城市'],
    '江西省': ['南昌市', '景德镇市', '萍乡市', '九江市', '新余市', '鹰潭市', '赣州市', '吉安市', '宜春市', '抚州市', '上饶市'],
    '河北省': ['石家庄市', '唐山市', '秦皇岛市', '邯郸市', '邢台市', '保定市', '张家口市', '承德市', '沧州市', '廊坊市', '衡水市'],
    '山西省': ['太原市', '大同市', '阳泉市', '长治市', '晋城市', '朔州市', '晋中市', '运城市', '忻州市', '临汾市', '吕梁市'],
    '陕西省': ['西安市', '铜川市', '宝鸡市', '咸阳市', '渭南市', '延安市', '汉中市', '榆林市', '安康市', '商洛市'],
    '甘肃省': ['兰州市', '嘉峪关市', '金昌市', '白银市', '天水市', '武威市', '张掖市', '平凉市', '酒泉市', '庆阳市', '定西市', '陇南市', '临夏州', '甘南州'],
    '青海省': ['西宁市', '海东市', '海北州', '黄南州', '海南州', '果洛州', '玉树州', '海西州'],
    '宁夏区': ['银川市', '石嘴山市', '吴忠市', '固原市', '中卫市'],
    '新疆区': ['乌鲁木齐市', '克拉玛依市', '吐鲁番市', '哈密市', '昌吉州', '博尔塔拉州', '巴音郭楞州', '阿克苏地区', '克孜勒苏州', '喀什地区', '和田地区', '伊犁州', '塔城地区', '阿勒泰地区'],
    '西藏区': ['拉萨市', '日喀则市', '昌都市', '林芝市', '山南市', '那曲市', '阿里地区'],
    '内蒙古区': ['呼和浩特市', '包头市', '乌海市', '赤峰市', '通辽市', '鄂尔多斯市', '呼伦贝尔市', '巴彦淖尔市', '乌兰察布市', '兴安盟', '锡林郭勒盟', '阿拉善盟'],
    '广西区': ['南宁市', '柳州市', '桂林市', '梧州市', '北海市', '防城港市', '钦州市', '贵港市', '玉林市', '百色市', '贺州市', '河池市', '来宾市', '崇左市'],
    '云南省': ['昆明市', '曲靖市', '玉溪市', '保山市', '昭通市', '丽江市', '普洱市', '临沧市', '楚雄州', '红河州', '文山州', '西双版纳州', '大理州', '德宏州', '怒江州', '迪庆州'],
    '贵州省': ['贵阳市', '六盘水市', '遵义市', '安顺市', '毕节市', '铜仁市', '黔西南州', '黔东南州', '黔南州'],
    '辽宁省': ['沈阳市', '大连市', '鞍山市', '抚顺市', '本溪市', '丹东市', '锦州市', '营口市', '阜新市', '辽阳市', '盘锦市', '铁岭市', '朝阳市', '葫芦岛市'],
    '吉林省': ['长春市', '吉林市', '四平市', '辽源市', '通化市', '白山市', '松原市', '白城市', '延边州'],
    '黑龙江省': ['哈尔滨市', '齐齐哈尔市', '鸡西市', '鹤岗市', '双鸭山市', '大庆市', '伊春市', '佳木斯市', '七台河市', '牡丹江市', '黑河市', '绥化市', '大兴安岭地区'],
    '海南省': ['海口市', '三亚市', '三沙市', '儋州市'],
    '台湾省': ['台北市', '新北市', '桃园市', '台中市', '台南市', '高雄市', '基隆市', '新竹市', '嘉义市', '新竹县', '苗栗县', '彰化县', '南投县', '云林县', '嘉义县', '屏东县', '宜兰县', '花莲县', '台东县', '澎湖县', '金门县', '连江县'],
    '香港特区': ['香港'],
    '澳门特区': ['澳门']
  },
  '日本': {
    '关东地方': ['东京都', '横滨市', '川崎市', '埼玉市', '千叶市', '水户市', '宇都宫市', '前桥市'],
    '关西地方': ['大阪市', '京都市', '神户市', '奈良市', '和歌山市', '大津市'],
    '中部地方': ['名古屋市', '静冈市', '新潟市', '富山市', '金沢市', '福井市', '甲府市', '长野市', '岐阜市'],
    '九州地方': ['福冈市', '北九州市', '佐賀市', '长崎市', '熊本市', '大分市', '宫崎市', '鹿儿岛市'],
    '东北地方': ['仙台市', '青森市', '盛冈市', '秋田市', '山形市', '福岛市'],
    '中国地方': ['广岛市', '冈山市', '山口市', '鸟取市', '松江市'],
    '四国地方': ['高松市', '松山市', '高知市', '德岛市'],
    '北海道地方': ['札幌市', '函馆市', '旭川市', '釧路市', '帯広市'],
    '冲绳地方': ['那霸市', '石垣市', '宫古岛市']
  },
  '韩国': {
    '首尔特别市': ['首尔市'],
    '釜山广域市': ['釜山市'],
    '大邱广域市': ['大邱市'],
    '仁川广域市': ['仁川市'],
    '光州广域市': ['光州市'],
    '大田广域市': ['大田市'],
    '蔚山广域市': ['蔚山市'],
    '世宗特别自治市': ['世宗市'],
    '京畿道': ['水原市', '成南市', '高阳市', '安山市', '安养市', '富川市'],
    '江原道': ['春川市', '江陵市', '束草市'],
    '忠清北道': ['清州市', '忠州市'],
    '忠清南道': ['天安市', '公州市'],
    '全罗北道': ['全州市', '群山市'],
    '全罗南道': ['光阳市', '丽水市', '木浦市'],
    '庆尚北道': ['浦项市', '庆州市', '安东市'],
    '庆尚南道': ['昌原市', '晋州市', '统营市'],
    '济州特别自治道': ['济州市', '西归浦市']
  },
  '美国': {
    '加利福尼亚州': ['洛杉矶', '旧金山', '圣地亚哥', '萨克拉门托', '奥克兰', '圣何塞', '长滩', '弗雷斯诺'],
    '纽约州': ['纽约市', '奥尔巴尼', '布法罗', '罗切斯特', '锡拉丘兹'],
    '德克萨斯州': ['休斯敦', '达拉斯', '奥斯汀', '圣安东尼奥', '沃思堡', '埃尔帕索'],
    '佛罗里达州': ['迈阿密', '坦帕', '奥兰多', '杰克逊维尔', '塔拉哈西'],
    '伊利诺伊州': ['芝加哥', '斯普林菲尔德', '罗克福德'],
    '宾夕法尼亚州': ['费城', '匹兹堡', '哈里斯堡'],
    '俄亥俄州': ['哥伦布', '克利夫兰', '辛辛那提'],
    '密歇根州': ['底特律', '兰辛', '大急流城'],
    '乔治亚州': ['亚特兰大', '萨凡纳', '奥古斯塔'],
    '北卡罗来纳州': ['夏洛特', '罗利', '格林斯伯勒'],
    '新泽西州': ['纽瓦克', '泽西城', '特伦顿'],
    '弗吉尼亚州': ['弗吉尼亚海滩', '诺福克', '里士满'],
    '华盛顿州': ['西雅图', '斯波坎', '塔科马'],
    '马萨诸塞州': ['波士顿', '伍斯特', '斯普林菲尔德'],
    '印第安纳州': ['印第安纳波利斯', '韦恩堡', '埃文斯维尔'],
    '亚利桑那州': ['凤凰城', '图森', '梅萨'],
    '田纳西州': ['纳什维尔', '孟菲斯', '诺克斯维尔'],
    '密苏里州': ['堪萨斯城', '圣路易斯', '斯普林菲尔德'],
    '马里兰州': ['巴尔的摩', '安纳波利斯', '盖瑟斯堡'],
    '威斯康星州': ['密尔沃基', '麦迪逊', '格林贝'],
    '明尼苏达州': ['明尼阿波利斯', '圣保罗', '罗切斯特'],
    '科罗拉多州': ['丹佛', '科罗拉多斯普林斯', '奥罗拉'],
    '阿拉巴马州': ['伯明翰', '蒙哥马利', '亨茨维尔'],
    '南卡罗来纳州': ['哥伦比亚', '查尔斯顿', '格林维尔'],
    '路易斯安那州': ['新奥尔良', '巴吞鲁日', '什里夫波特'],
    '肯塔基州': ['路易斯维尔', '词典城', '鲍灵格林'],
    '俄勒冈州': ['波特兰', '塞勒姆', '尤金'],
    '俄克拉荷马州': ['俄克拉荷马城', '塔尔萨', '诺曼'],
    '康涅狄格州': ['布里奇波特', '纽黑文', '哈特福德'],
    '犹他州': ['盐湖城', '西瓦利城', '普罗沃'],
    '内华达州': ['拉斯维加斯', '雷诺', '亨德森'],
    '阿肯色州': ['小石城', '费耶特维尔', '史密斯堡'],
    '密西西比州': ['杰克逊', '格尔夫波特', '南港'],
    '堪萨斯州': ['威奇托', '欧弗兰帕克', '堪萨斯城'],
    '新墨西哥州': ['阿尔伯克基', '拉斯克鲁塞斯', '圣菲'],
    '内布拉斯加州': ['奥马哈', '林肯', '贝尔维尤'],
    '西弗吉尼亚州': ['查尔斯顿', '亨廷顿', '摩根敦'],
    '爱达荷州': ['博伊西', '纳帕', '爱达荷福尔斯'],
    '夏威夷州': ['檀香山', '珍珠城', '希洛'],
    '缅因州': ['波特兰', '刘易斯顿', '班戈'],
    '新罕布什尔州': ['曼彻斯特', '纳舒厄', '康科德'],
    '罗得岛州': ['普罗维登斯', '沃威克', '克兰斯顿'],
    '蒙大拿州': ['比灵斯', '米苏拉', '大瀑布城'],
    '特拉华州': ['威明顿', '多佛', '纽瓦克'],
    '南达科他州': ['苏福尔斯', '拉皮德城', '阿伯丁'],
    '北达科他州': ['法戈', '俾斯麦', '大福克斯'],
    '阿拉斯加州': ['安克雷奇', '费尔班克斯', '朱诺'],
    '佛蒙特州': ['伯灵顿', '埃塞克斯', '南伯灵顿'],
    '怀俄明州': ['夏延', '卡斯珀', '拉勒米']
  },
  '英国': {
    '英格兰': ['伦敦', '伯明翰', '利物浦', '曼彻斯特', '谢菲尔德', '利兹', '布里斯托尔', '纽卡斯尔', '诺丁汉', '南安普敦', '朴茨茅斯', '莱斯特', '考文垂', '赫尔', '普利茅斯', '斯托克', '德比', '沃尔弗汉普顿', '斯旺西', '贝尔法斯特'],
    '苏格兰': ['爱丁堡', '格拉斯哥', '阿伯丁', '邓迪', '斯特林', '因弗内斯'],
    '威尔士': ['卡迪夫', '斯旺西', '纽波特', '雷克瑟姆'],
    '北爱尔兰': ['贝尔法斯特', '德里', '利斯本', '纽里']
  },
  '法国': {
    '法兰西岛大区': ['巴黎', '凡尔赛', '圣丹尼'],
    '普罗旺斯-阿尔卑斯-蓝色海岸大区': ['马赛', '尼斯', '戛纳', '阿维尼翁', '土伦'],
    '奥弗涅-罗纳-阿尔卑斯大区': ['里昂', '格勒诺布尔', '圣艾蒂安', '克莱蒙费朗'],
    '新阿基坦大区': ['波尔多', '利摩日', '普瓦捷'],
    '奥克西塔尼大区': ['图卢兹', '蒙彼利埃', '尼姆', '佩皮尼昂'],
    '大东部大区': ['斯特拉斯堡', '兰斯', '梅斯', '南锡'],
    '上法兰西大区': ['里尔', '亚眠', '加来'],
    '诺曼底大区': ['鲁昂', '勒阿弗尔', '卡昂'],
    '布列塔尼大区': ['雷恩', '布雷斯特', '洛里昂'],
    '卢瓦尔河地区大区': ['南特', '昂热', '勒芒'],
    '中央-卢瓦尔河谷大区': ['奥尔良', '图尔', '布尔日'],
    '勃艮第-弗朗什-孔泰大区': ['第戎', '贝桑松', '欧塞尔'],
    '科西嘉': ['阿雅克肖', '巴斯蒂亚']
  },
  '德国': {
    '北莱茵-威斯特法伦州': ['科隆', '杜塞尔多夫', '多特蒙德', '埃森', '杜伊斯堡', '波鸿', '伍珀塔尔', '比勒费尔德', '波恩', '明斯特'],
    '巴伐利亚州': ['慕尼黑', '纽伦堡', '奥格斯堡', '雷根斯堡', '因戈尔施塔特', '维尔茨堡', '富尔特'],
    '巴登-符腾堡州': ['斯图加特', '曼海姆', '卡尔斯鲁厄', '弗莱堡', '海德堡', '乌尔姆', '海尔布隆'],
    '下萨克森州': ['汉诺威', '不伦瑞克', '奥尔登堡', '奥斯纳布吕克', '沃尔夫斯堡', '哥廷根'],
    '黑森州': ['法兰克福', '威斯巴登', '卡塞尔', '达姆施塔特', '奥芬巴赫'],
    '萨克森州': ['德累斯顿', '莱比锡', '开姆尼茨'],
    '莱茵兰-普法尔茨州': ['美因茨', '路德维希港', '科布伦茨', '凯泽斯劳滕'],
    '柏林': ['柏林'],
    '汉堡': ['汉堡'],
    '不来梅': ['不来梁', '不来梅哈芬'],
    '萨尔州': ['萨尔布吕肯'],
    '勃兰登堡州': ['波茨坦', '科特布斯', '法兰克福'],
    '梅克伦堡-前波莫瑞州': ['什未林', '罗斯托克'],
    '萨克森-安哈尔特州': ['马德堡', '哈雷'],
    '图林根州': ['埃尔福特', '耶拿', '盖拉']
  },
  '意大利': {
    '拉齐奥大区': ['罗马'],
    '伦巴第大区': ['米兰', '贝加莫', '布雷西亚'],
    '坎帕尼亚大区': ['那不勒斯', '萨勒诺'],
    '西西里大区': ['巴勒莫', '卡塔尼亚', '墨西拿'],
    '威尼托大区': ['威尼斯', '维罗纳', '帕多瓦'],
    '艾米利亚-罗马涅大区': ['博洛尼亚', '摩德纳', '帕尔马'],
    '皮埃蒙特大区': ['都灵', '诺瓦拉'],
    '普利亚大区': ['巴里', '塔兰托'],
    '托斯卡纳大区': ['佛罗伦萨', '比萨', '锡耶纳'],
    '卡拉布里亚大区': ['雷焦卡拉布里亚', '科森扎'],
    '撒丁岛大区': ['卡利亚里', '萨萨里'],
    '利古里亚大区': ['热那亚'],
    '马尔凯大区': ['安科纳'],
    '阿布鲁佐大区': ['佩斯卡拉'],
    '翁布里亚大区': ['佩鲁贾'],
    '巴西利卡塔大区': ['波坦察'],
    '莫利塞大区': ['坎波巴索'],
    '弗留利-威尼斯朱利亚大区': ['的里雅斯特'],
    '特伦蒂诺-上阿迪杰大区': ['特伦托', '博尔扎诺'],
    '瓦莱达奥斯塔大区': ['奥斯塔']
  },
  '西班牙': {
    '马德里自治区': ['马德里'],
    '加泰罗尼亚': ['巴塞罗那', '塔拉戈纳', '赫罗纳', '莱里达'],
    '安达卢西亚': ['塞维利亚', '马拉加', '科尔多瓦', '格拉纳达', '加的斯', '阿尔梅里亚', '韦尔瓦', '哈恩'],
    '瓦伦西亚': ['瓦伦西亚', '阿利坎特', '卡斯特利翁'],
    '加利西亚': ['拉科鲁尼亚', '维戈', '圣地亚哥德孔波斯特拉', '奥伦塞'],
    '巴斯克地区': ['毕尔巴鄂', '圣塞巴斯蒂安', '维多利亚'],
    '卡斯蒂利亚-莱昂': ['瓦利亚多利德', '萨拉曼卡', '莱昂', '布尔戈斯'],
    '阿拉贡': ['萨拉戈萨', '韦斯卡', '特鲁埃尔'],
    '卡斯蒂利亚-拉曼恰': ['托莱多', '阿尔瓦塞特', '雷阿尔城'],
    '穆尔西亚': ['穆尔西亚', '卡塔赫纳'],
    '阿斯图里亚斯': ['奥维耶多', '希洪'],
    '埃斯特雷马杜拉': ['巴达霍斯', '卡塞雷斯'],
    '巴利阿里群岛': ['帕尔马', '伊维萨'],
    '加那利群岛': ['拉斯帕尔马斯', '圣克鲁斯-德特内里费'],
    '坎塔布里亚': ['桑坦德'],
    '拉里奥哈': ['洛格罗尼奥'],
    '纳瓦拉': ['潘普洛纳'],
    '休达': ['休达'],
    '梅利利亚': ['梅利利亚']
  },
  '加拿大': {
    '安大略省': ['多伦多', '渥太华', '汉密尔顿', '伦敦', '温莎', '基奇纳'],
    '魁北克省': ['蒙特利尔', '魁北克城', '拉瓦尔', '加蒂诺'],
    '不列颠哥伦比亚省': ['温哥华', '维多利亚', '本拿比', '里士满'],
    '阿尔伯塔省': ['卡尔加里', '埃德蒙顿', '红鹿市'],
    '马尼托巴省': ['温尼伯', '布兰登'],
    '萨斯喀彻温省': ['萨斯卡通', '里贾纳'],
    '新斯科舍省': ['哈利法克斯', '悉尼'],
    '新不伦瑞克省': ['圣约翰', '蒙克顿', '弗雷德里克顿'],
    '纽芬兰和拉布拉多省': ['圣约翰斯'],
    '爱德华王子岛省': ['夏洛特敦'],
    '西北地区': ['耶洛奈夫'],
    '育空地区': ['白马市'],
    '努纳武特地区': ['伊魁特']
  },
  '澳大利亚': {
    '新南威尔士州': ['悉尼', '纽卡斯尔', '卧龙岗', '奥尔伯里'],
    '维多利亚州': ['墨尔本', '吉朗', '弗兰克斯顿'],
    '昆士兰州': ['布里斯班', '黄金海岸', '凯恩斯', '汤斯维尔'],
    '西澳大利亚州': ['珀斯', '弗里曼特尔'],
    '南澳大利亚州': ['阿德莱德'],
    '塔斯马尼亚州': ['霍巴特', '朗塞斯顿'],
    '北领地': ['达尔文', '爱丽斯泉'],
    '澳大利亚首都特区': ['堪培拉']
  },
  '新西兰': {
    '北岛': ['奥克兰', '惠灵顿', '汉密尔顿', '陶朗加', '内皮尔', '北帕默斯顿'],
    '南岛': ['基督城', '达尼丁', '因弗卡吉尔', '纳尔逊', '蒂马鲁']
  },
  '俄罗斯': {
    '中央联邦区': ['莫斯科', '沃罗涅日', '雅罗斯拉夫尔', '图拉'],
    '西北联邦区': ['圣彼得堡', '加里宁格勒', '阿尔汉格尔斯克', '摩尔曼斯克'],
    '南部联邦区': ['罗斯托夫', '克拉斯诺达尔', '沃尔戈格勒', '阿斯特拉罕'],
    '伏尔加联邦区': ['下诺夫哥罗德', '喀山', '萨马拉', '乌法', '萨拉托夫'],
    '乌拉尔联邦区': ['叶卡捷琳堡', '车里雅宾斯克', '秋明', '库尔干'],
    '西伯利亚联邦区': ['新西伯利亚', '鄂木斯克', '克拉斯诺雅尔斯克', '伊尔库茨克'],
    '远东联邦区': ['符拉迪沃斯托克', '哈巴罗夫斯克', '雅库茨克', '马加丹'],
    '北高加索联邦区': ['皮亚季戈尔斯克', '斯塔夫罗波尔', '马哈奇卡拉']
  },
  '印度': {
    '马哈拉施特拉邦': ['孟买', '浦那', '纳格浦尔', '纳西克'],
    '德里': ['新德里', '德里'],
    '西孟加拉邦': ['加尔各答', '豪拉'],
    '泰米尔纳德邦': ['金奈', '哥印拜陀', '马杜赖'],
    '卡纳塔克邦': ['班加罗尔', '迈索尔', '芒格洛尔'],
    '古吉拉特邦': ['艾哈迈达巴德', '苏拉特', '瓦多达拉'],
    '拉贾斯坦邦': ['斋浦尔', '焦特布尔', '乌代浦尔'],
    '安得拉邦': ['海得拉巴', '维沙卡帕特南'],
    '中央邦': ['博帕尔', '印多尔'],
    '奥里萨邦': ['布巴内什瓦尔', '库塔克'],
    '旁遮普邦': ['阿姆利则', '卢迪亚纳'],
    '哈里亚纳邦': ['古尔冈', '法里达巴德'],
    '喀拉拉邦': ['科钦', '特里凡得琅'],
    '阿萨姆邦': ['古瓦哈提'],
    '北方邦': ['勒克瑙', '坎普尔', '阿格拉', '瓦拉纳西']
  },
  '泰国': {
    '曼谷都市区': ['曼谷'],
    '北部地区': ['清迈', '清莱', '南邦', '帕夭'],
    '东北地区': ['呵叻', '乌隆他尼', '孔敬', '乌汶'],
    '中部地区': ['大城', '北碧', '彭世洛'],
    '东部地区': ['芭堤雅', '春武里', '罗勇'],
    '南部地区': ['普吉', '苏梅岛', '甲米', '春蓬', '素叻他尼', '宋卡']
  },
  '马来西亚': {
    '柔佛州': ['新山', '峇株巴辖'],
    '吉打州': ['亚罗士打', '双溪大年'],
    '吉兰丹州': ['哥打巴鲁'],
    '马六甲州': ['马六甲市'],
    '森美兰州': ['芙蓉'],
    '彭亨州': ['关丹'],
    '槟城州': ['乔治市'],
    '霹雳州': ['怡保', '太平'],
    '玻璃市州': ['加央'],
    '雪兰莪州': ['莎阿南', '八打灵再也'],
    '登嘉楼州': ['瓜拉登嘉楼'],
    '沙巴州': ['亚庇', '山打根'],
    '砂拉越州': ['古晋', '美里'],
    '联邦直辖区': ['吉隆坡', '布城', '纳闽']
  },
  '新加坡': {
    '新加坡': ['新加坡市']
  },
  '印度尼西亚': {
    '爪哇岛': ['雅加达', '万隆', '泗水', '三宝垄', '日惹'],
    '苏门答腊岛': ['棉兰', '巨港', '巴东'],
    '加里曼丹岛': ['坤甸', '三马林达'],
    '苏拉威西岛': ['乌戎潘当', '望加锡'],
    '巴厘岛': ['登巴萨', '乌布']
  },
  '菲律宾': {
    '吕宋岛': ['马尼拉', '奎松市', '卡洛奥坎'],
    '维萨亚斯群岛': ['宿务市', '伊洛伊洛'],
    '棉兰老岛': ['达沃', '卡加延德奥罗']
  },
  '越南': {
    '北部地区': ['河内', '海防', '下龙'],
    '中部地区': ['岘港', '顺化', '会安'],
    '南部地区': ['胡志明市', '芹苴']
  },
  '土耳其': {
    '马尔马拉地区': ['伊斯坦布尔', '布尔萨', '科贾埃利'],
    '爱琴海地区': ['伊兹密尔', '安塔利亚'],
    '地中海地区': ['阿达纳', '梅尔辛'],
    '中安纳托利亚地区': ['安卡拉', '科尼亚'],
    '黑海地区': ['萨姆松', '特拉布宗'],
    '东安纳托利亚地区': ['埃尔祖鲁姆'],
    '东南安纳托利亚地区': ['加济安泰普', '桑利乌尔法']
  },
  '阿联酋': {
    '阿布扎比酋长国': ['阿布扎比'],
    '迪拜酋长国': ['迪拜'],
    '沙迦酋长国': ['沙迦'],
    '阿治曼酋长国': ['阿治曼'],
    '富查伊拉酋长国': ['富查伊拉'],
    '哈伊马角酋长国': ['哈伊马角'],
    '乌姆盖万酋长国': ['乌姆盖万']
  },
  '沙特阿拉伯': {
    '利雅得省': ['利雅得'],
    '麦加省': ['吉达', '麦加', '塔伊夫'],
    '东部省': ['达曼', '胡拜尔', '朱拜勒'],
    '麦地那省': ['麦地那'],
    '卡西姆省': ['布赖代'],
    '阿西尔省': ['阿卜哈'],
    '塔布克省': ['塔布克'],
    '哈伊勒省': ['哈伊勒'],
    '北边境省': ['阿尔阿尔'],
    '吉赞省': ['吉赞'],
    '纳季兰省': ['纳季兰'],
    '巴哈省': ['巴哈'],
    '焦夫省': ['萨卡卡']
  },
  '埃及': {
    '开罗省': ['开罗'],
    '吉萨省': ['吉萨'],
    '亚历山大省': ['亚历山大'],
    '阿斯旺省': ['阿斯旺'],
    '卢克索省': ['卢克索'],
    '红海省': ['赫尔格达'],
    '南西奈省': ['沙姆沙伊赫'],
    '北西奈省': ['阿里什'],
    '苏伊士省': ['苏伊士']
  },
  '南非': {
    '豪登省': ['约翰内斯堡', '比勒陀利亚'],
    '西开普省': ['开普敦'],
    '夸祖鲁-纳塔尔省': ['德班'],
    '东开普省': ['伊丽莎白港', '东伦敦'],
    '自由州省': ['布隆方丹'],
    '林波波省': ['波罗克瓦尼'],
    '姆普马兰加省': ['内尔斯普雷特'],
    '西北省': ['马菲肯'],
    '北开普省': ['金伯利']
  },
  '巴西': {
    '圣保罗州': ['圣保罗', '坎皮纳斯', '圣安德烈'],
    '里约热内卢州': ['里约热内卢', '尼泰罗伊'],
    '米纳斯吉拉斯州': ['贝洛奥里藏特', '乌贝兰迪亚'],
    '巴伊亚州': ['萨尔瓦多'],
    '巴拉那州': ['库里蒂巴'],
    '南里奥格兰德州': ['阿雷格里港'],
    '塞阿拉州': ['福塔莱萨'],
    '伯南布哥州': ['累西腓'],
    '戈亚斯州': ['戈亚尼亚'],
    '马拉尼昂州': ['圣路易斯'],
    '帕拉伊巴州': ['若昂佩索阿'],
    '马托格罗索州': ['库亚巴'],
    '联邦区': ['巴西利亚'],
    '亚马孙州': ['马瑙斯'],
    '朗多尼亚州': ['阿雷格里港韦柳'],
    '圣卡塔琳娜州': ['弗洛里亚诺波利斯']
  },
  '阿根廷': {
    '布宜诺斯艾利斯省': ['布宜诺斯艾利斯', '拉普拉塔'],
    '科尔多瓦省': ['科尔多瓦'],
    '圣菲省': ['罗萨里奥', '圣菲'],
    '门多萨省': ['门多萨'],
    '图库曼省': ['图库曼'],
    '萨尔塔省': ['萨尔塔'],
    '米西奥内斯省': ['波萨达斯'],
    '查科省': ['雷西斯滕西亚'],
    '科连特斯省': ['科连特斯'],
    '恩特雷里奥斯省': ['巴拉那'],
    '圣地亚哥德埃斯特罗省': ['圣地亚哥德埃斯特罗'],
    '火地岛省': ['乌斯怀亚']
  },
  '智利': {
    '圣地亚哥首都大区': ['圣地亚哥'],
    '瓦尔帕莱索大区': ['瓦尔帕莱索', '比尼亚德尔马'],
    '阿劳卡尼亚大区': ['特木科'],
    '比奥比奥大区': ['康塞普西翁'],
    '安托法加斯塔大区': ['安托法加斯塔'],
    '塔拉帕卡大区': ['伊基克'],
    '阿塔卡马大区': ['科皮亚波'],
    '科金博大区': ['拉塞雷纳'],
    '奥希金斯大区': ['兰卡瓜'],
    '马乌莱大区': ['塔尔卡'],
    '洛斯拉戈斯大区': ['奥索尔诺'],
    '艾森大区': ['科伊艾克'],
    '麦哲伦大区': ['蓬塔阿雷纳斯']
  },
  '墨西哥': {
    '墨西哥城': ['墨西哥城'],
    '哈利斯科州': ['瓜达拉哈拉'],
    '新莱昂州': ['蒙特雷'],
    '普埃布拉州': ['普埃布拉'],
    '瓜纳华托州': ['莱昂'],
    '韦拉克鲁斯州': ['韦拉克鲁斯'],
    '尤卡坦州': ['梅里达'],
    '奇瓦瓦州': ['奇瓦瓦'],
    '索诺拉州': ['埃莫西约'],
    '塔毛利帕斯州': ['雷诺萨'],
    '锡那罗亚州': ['库利亚坎'],
    '北下加利福尼亚州': ['蒂华纳'],
    '金塔纳罗奥州': ['坎昆', '奇琴伊察']
  }
};

interface CitySelectorProps {
  onCityChange?: (country: string, province: string, city: string) => void;
}

const CitySelector = ({ onCityChange }: CitySelectorProps) => {
  const { selectedCountry, selectedProvince, selectedCity, updateCity } = useCityContext();
  const [isOpen, setIsOpen] = useState(false);

  const getProvinces = () => {
    if (!selectedCountry || !cityData[selectedCountry]) return [];
    return Object.keys(cityData[selectedCountry]);
  };

  const getCities = () => {
    if (!selectedCountry || !selectedProvince || !cityData[selectedCountry]?.[selectedProvince]) return [];
    return cityData[selectedCountry][selectedProvince];
  };

  const handleCountryChange = (country: string) => {
    const provinces = Object.keys(cityData[country]);
    const newProvince = provinces.length > 0 ? provinces[0] : '';
    const cities = newProvince ? cityData[country][newProvince] : [];
    const newCity = cities.length > 0 ? cities[0] : '';
    updateCity(country, newProvince, newCity);
  };

  const handleProvinceChange = (province: string) => {
    const cities = cityData[selectedCountry][province];
    const newCity = cities.length > 0 ? cities[0] : '';
    updateCity(selectedCountry, province, newCity);
  };

  const handleCityChange = (city: string) => {
    updateCity(selectedCountry, selectedProvince, city);
    setIsOpen(false);
  };

  return (
    <DropdownMenu open={isOpen} onOpenChange={setIsOpen}>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" className="flex items-center">
          <Globe className="h-4 w-4 mr-2" />
          {selectedCity}
          <ChevronDown className="h-4 w-4 ml-2" />
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent className="w-80 p-4 bg-white border shadow-lg z-[9999] fixed">
        <div className="space-y-4">
          <div>
            <label className="text-sm font-medium text-gray-700 block mb-2">国家</label>
            <Select value={selectedCountry} onValueChange={handleCountryChange}>
              <SelectTrigger>
                <SelectValue placeholder="选择国家" />
              </SelectTrigger>
              <SelectContent className="z-[9999] max-h-60 overflow-y-auto">
                {Object.keys(cityData).map((country) => (
                  <SelectItem key={country} value={country}>{country}</SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          <div>
            <label className="text-sm font-medium text-gray-700 block mb-2">省/州/地区</label>
            <Select value={selectedProvince} onValueChange={handleProvinceChange} disabled={!selectedCountry || getProvinces().length === 0}>
              <SelectTrigger>
                <SelectValue placeholder="选择省份" />
              </SelectTrigger>
              <SelectContent className="z-[9999] max-h-60 overflow-y-auto">
                {getProvinces().map((province) => (
                  <SelectItem key={province} value={province}>{province}</SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          <div>
            <label className="text-sm font-medium text-gray-700 block mb-2">城市</label>
            <Select value={selectedCity} onValueChange={handleCityChange} disabled={!selectedProvince || getCities().length === 0}>
              <SelectTrigger>
                <SelectValue placeholder="选择城市" />
              </SelectTrigger>
              <SelectContent className="z-[9999] max-h-60 overflow-y-auto">
                {getCities().map((city) => (
                  <SelectItem key={city} value={city}>{city}</SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </div>
      </DropdownMenuContent>
    </DropdownMenu>
  );
};

export default CitySelector;
